import * as React from 'react';
import Svg, { Defs, G, Image, Mask, Path } from 'react-native-svg';
import { MaskImageProps } from './MaskImage.model';

/**
 * Componente de imagem com máscara para o ForYouCard
 *
 * Aplica uma máscara SVG customizada sobre a imagem fornecida.
 */
export const MaskImage: React.FC<MaskImageProps> = ({ source }) => {
  const maskId = React.useMemo(
    () => `mask-${Math.random().toString(36).substr(2, 9)}`,
    []
  );

  if (!source) {
    return null;
  }

  const getImageHref = () => {
    if (typeof source === 'string') return source;
    if (typeof source === 'number') return source;
    if (typeof source === 'object' && source !== null && 'uri' in source) {
      return source.uri;
    }
    return source;
  };

  return (
    <Svg width="190" height="194" viewBox="0 0 190 194" fill="none">
      <Defs>
        <Mask id={maskId}>
          <Path
            fill="white"
            d="M178.917 191.09C177.903 191.651 176.784 192.125 175.56 192.513C174.378 192.901 173.09 193.224 171.697 193.483C170.303 193.698 168.847 193.849 167.327 193.935C165.764 194.022 164.139 194.022 162.45 193.935C160.761 193.892 158.988 193.784 157.13 193.612C155.314 193.396 153.436 193.138 151.493 192.836C149.551 192.491 147.546 192.103 145.477 191.672C143.45 191.241 141.36 190.767 139.207 190.25C137.053 189.689 134.879 189.086 132.683 188.439C130.446 187.836 128.187 187.167 125.907 186.435C123.627 185.702 121.304 184.926 118.94 184.107C116.618 183.331 114.274 182.49 111.91 181.585C109.503 180.723 107.118 179.818 104.753 178.869C102.347 177.964 99.94 177.016 97.5333 176.024C95.1267 175.033 92.72 174.02 90.3133 172.985C87.9067 171.951 85.5211 170.916 83.1567 169.881C80.75 168.804 78.3856 167.726 76.0633 166.648C73.6989 165.527 71.3556 164.407 69.0333 163.286C66.7533 162.165 64.4733 161.023 62.1933 159.859C59.9556 158.695 57.7389 157.531 55.5433 156.367C53.3478 155.16 51.1944 153.953 49.0833 152.746C46.9722 151.539 44.9033 150.289 42.8767 148.996C40.8922 147.746 38.9289 146.474 36.9867 145.181C35.0444 143.888 33.1656 142.573 31.35 141.236C29.5767 139.9 27.8244 138.542 26.0933 137.163C24.4044 135.783 22.8 134.382 21.28 132.96C19.7178 131.537 18.2189 130.093 16.7833 128.627C15.39 127.162 14.06 125.675 12.7933 124.166C11.5267 122.657 10.3444 121.127 9.24667 119.575C8.14889 118.023 7.15667 116.428 6.27 114.79C5.34111 113.195 4.51778 111.557 3.8 109.876C3.08222 108.238 2.47 106.556 1.96333 104.832C1.41444 103.108 0.992222 101.362 0.696667 99.5945C0.358889 97.8271 0.147778 96.0382 0.0633333 94.2277C-0.0211111 92.4171 -0.0211111 90.5851 0.0633333 88.7314C0.19 86.8778 0.401111 85.0242 0.696667 83.1706C0.992222 81.2738 1.39333 79.3771 1.9 77.4804C2.40667 75.6267 3.01889 73.7516 3.73667 71.8548C4.41222 69.9581 5.19333 68.0614 6.08 66.1646C6.92444 64.2679 7.87444 62.3927 8.93 60.5391C9.98556 58.6424 11.1256 56.7888 12.35 54.9783C13.5744 53.1246 14.8833 51.2926 16.2767 49.482C17.6278 47.7146 19.0844 45.9472 20.6467 44.1798C22.2089 42.4124 23.8344 40.6881 25.5233 39.0069C27.2122 37.3257 28.9856 35.6876 30.8433 34.0927C32.7011 32.4546 34.6222 30.8811 36.6067 29.3724C38.5911 27.8205 40.6389 26.3333 42.75 24.9108C44.8611 23.4882 47.0567 22.1088 49.3367 20.7724C51.5744 19.4361 53.8967 18.1644 56.3033 16.9574C58.6678 15.7504 61.0956 14.6081 63.5867 13.5304C66.0778 12.4527 68.6322 11.4181 71.25 10.4266C73.8256 9.47827 76.4433 8.59456 79.1033 7.77552C81.7633 6.95648 84.4444 6.20209 87.1467 5.51237C89.8911 4.82265 92.6356 4.1976 95.38 3.6372C98.1244 3.03369 100.869 2.5164 103.613 2.08533C106.358 1.65425 109.081 1.28784 111.783 0.986085C114.528 0.684332 117.251 0.468794 119.953 0.339472C122.613 0.167042 125.273 0.0592728 127.933 0.0161653C130.551 -0.0269422 133.127 0.0161653 135.66 0.145488C138.193 0.231703 140.684 0.404133 143.133 0.662778C145.582 0.921423 147.947 1.24473 150.227 1.6327C152.549 1.97756 154.787 2.40863 156.94 2.92592C159.093 3.44321 161.141 4.04672 163.083 4.73644C165.068 5.38305 166.947 6.11588 168.72 6.93492C170.493 7.71086 172.161 8.57301 173.723 9.52137C175.286 10.4697 176.721 11.4828 178.03 12.5605C179.339 13.6381 180.521 14.7805 181.577 15.9875C182.632 17.2376 183.582 18.5308 184.427 19.8672C185.229 21.2466 185.947 22.6692 186.58 24.1348C187.213 25.6005 187.741 27.1308 188.163 28.7258C188.586 30.3208 188.944 31.9588 189.24 33.64C189.493 35.3212 189.683 37.0671 189.81 38.8776C189.937 40.645 190 42.4555 190 44.3091C190 46.2059 189.958 48.1242 189.873 50.064C189.747 52.0038 189.599 53.9868 189.43 56.0128C189.261 57.9958 189.05 60.0218 188.797 62.091C188.586 64.1602 188.332 66.2724 188.037 68.4278C187.783 70.5401 187.509 72.6739 187.213 74.8293C186.918 76.9846 186.622 79.1616 186.327 81.36C186.031 83.5154 185.757 85.7139 185.503 87.9555C185.25 90.154 185.018 92.3525 184.807 94.551C184.596 96.7926 184.427 99.0126 184.3 101.211C184.173 103.453 184.089 105.673 184.047 107.871C184.004 110.113 184.004 112.333 184.047 114.531C184.089 116.73 184.173 118.907 184.3 121.062C184.384 123.261 184.511 125.416 184.68 127.528C184.849 129.684 185.018 131.796 185.187 133.865C185.398 135.977 185.609 138.046 185.82 140.072C186.031 142.099 186.242 144.103 186.453 146.086C186.664 148.026 186.854 149.944 187.023 151.841C187.234 153.738 187.403 155.591 187.53 157.402C187.699 159.169 187.826 160.915 187.91 162.639C187.994 164.32 188.037 165.98 188.037 167.618C188.037 169.213 187.994 170.743 187.91 172.209C187.826 173.675 187.699 175.076 187.53 176.412C187.319 177.792 187.066 179.085 186.77 180.292C186.432 181.499 186.031 182.641 185.567 183.719C185.102 184.753 184.553 185.745 183.92 186.693C183.244 187.599 182.506 188.418 181.703 189.15C180.859 189.883 179.93 190.53 178.917 191.09Z"
          />
        </Mask>
      </Defs>
      <G mask={`url(#${maskId})`}>
        <Image
          x="0"
          y="0"
          width="190"
          height="194"
          preserveAspectRatio="xMidYMid slice"
          href={getImageHref()}
        />
      </G>
    </Svg>
  );
};
