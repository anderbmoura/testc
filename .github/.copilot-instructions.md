# GitHub Copilot Instructions - DSC Library

## Stack

React Native UI library: **React Native + TypeScript + Tamagui + iconoir-react-native + Storybook**

## Architecture

### File Structure

```
ComponentName/
  index.ts                    # Exports
  ComponentName.tsx           # Main component
  ComponentName.model.ts      # Types & interfaces
  ComponentName.stories.tsx   # Storybook stories
  ComponentName.styles.ts     # Styled components (if complex)
  components/                 # Sub-components (modular components)
    SubComponent/
      index.ts
      SubComponent.tsx
      SubComponent.model.ts
      SubComponent.styles.ts
  hooks/                      # Custom hooks (if needed)
    useComponentState.ts
    useComponentInteraction.ts
```

### Styled Components

```typescript
const StyledComponent = styled(View, {
  name: 'StyledComponent', // Required
  backgroundColor: '$color1',
  padding: '$medium',

  hoverStyle: { backgroundColor: '$color2' },
  pressStyle: { backgroundColor: '$color3' },
  focusStyle: { borderColor: '$color9', borderWidth: 2 },

  variants: {
    theme: {
      highlight: { borderColor: '$color9' },
      danger: { borderColor: '$red9' },
    },
  } as const,
});
```

## Design System

### Colors

- **Adaptive**: `$color1` (lightest) to `$color12` (darkest) - changes with theme
- **Semantic**: `$neutralBg1`, `$successBg` - always same color

### Spacing

`$nano` (1px), `$quark` (2px), `$tiny` (4px), `$small` (8px), `$medium` (16px), `$large` (24px), `$xl` (32px)

### Typography

Use components: `<TitleLarge>`, `<BodyStandard>`, `<LabelSmall>` - never direct Text styling

### Layout

- `YStack` (vertical), `XStack` (horizontal)
- Responsive props: `$sm={{ padding: '$large' }}`

## Icons

Always use `useTransformIcon` hook with iconoir-react-native:

```typescript
import { useTransformIcon } from '../utils';
import { Heart } from 'iconoir-react-native';

const icon = useTransformIcon(Heart, { size: 24, color: '$color9' });
```

## Standards

### TypeScript

```typescript
export interface ComponentProps extends ViewProps {
  /** Visual theme */
  theme?: 'highlight' | 'neutral' | 'danger';
  /** Main text */
  title: string;
  /** Press handler */
  onPress?: () => void;
}
```

### Component Requirements

- **Default theme**: 'highlight'
- **Accessibility**: accessibilityLabel, accessibilityRole
- **States**: focus, hover, press with proper styling
- **Z-index**: Use 500+ for focus borders

### Performance

```typescript
const Component = memo(({ data, onPress }) => {
  const handlePress = useCallback(() => {}, []);
  return <StyledComponent onPress={handlePress} />;
});
```

## Documentation

### JSDoc (Portuguese)

````typescript
/**
 * Componente DSC ComponentName
 *
 * Descrição breve do componente.
 *
 * @example
 * ```tsx
 * <ComponentName prop="valor" onPress={() => {}} />
 * ```
 */
````

### Storybook (MANDATORY)

```typescript
const meta: Meta<ComponentProps> = {
  title: 'Componentes/ComponentName',
  component: Component,
  parameters: {
    docs: {
      description: { component: 'Description in Portuguese...' },
      source: {
        transform: (_: string, { args }: any) => {
          // MANDATORY: Fix "Show code" to show proper icon names
          const props = [
            args.type && `type="${args.type}"`,
            args.icon && `icon={<${args.icon} />}`,
          ]
            .filter(Boolean)
            .join(' ');
          return `<ComponentName${props && ` ${props}`} onPress={() => {}} />`;
        },
        state: 'open',
      },
    },
  },
  tags: ['autodocs'],
};

export const Default: Story = { args: {} };
```

### Required Stories

- **Default**: Default component state (mandatory)
- **Other stories**: Create only if necessary to demonstrate specific functionality

### Show Code Configuration

**MANDATORY**: Configure `source.transform` to display correct JSX code:

```typescript
source: {
  transform: (_: string, { args }: any) => {
    const getIconName = (icon: any) =>
      icon && icon !== 'None'
        ? typeof icon === 'string'
          ? icon
          : Object.entries(iconMapping).find(
              ([name, comp]) => comp === icon && name !== 'None'
            )?.[0]
        : null;

    const props = [
      args.type && `type="${args.type}"`,
      args.icon && `icon={${getIconName(args.icon)}}`, // Fix icon names
    ].filter(Boolean).join(' ');
    return `<ComponentName${props && ` ${props}`} onPress={() => {}} />`;
  },
  state: 'open',
}
```

### Storybook Reactivity (CRITICAL)

**For components with conditional controls (icon/image mappings):**

1. **iconMapping MUST include `None: undefined`**:

```typescript
const iconMapping = {
  None: undefined, // MANDATORY for correct reactivity
  Home,
  Settings,
  // ... other icons
};
```

2. **argTypes should NOT have conditionals for mapped properties**:

```typescript
// ❌ WRONG - causes reactivity issues
icon: {
  control: 'select',
  if: { arg: 'style', eq: 'icon' }, // Remove this!
  options: Object.keys(iconMapping),
  mapping: iconMapping,
}

// ✅ CORRECT - always available
icon: {
  control: 'select',
  options: Object.keys(iconMapping),
  mapping: iconMapping,
  description: 'Component icon',
}
```

3. **render function MUST be simple with dynamic key**:

```typescript
render: args => {
  const key = `component-${Date.now()}`; // MANDATORY for reactivity
  return <Component key={key} {...args} />;
},
```

4. **DO NOT process args in render function** - let Storybook handle mappings automatically

## Exports

```typescript
// Component file
export { Component } from './Component';
export type { ComponentProps } from './Component.model';

// Main index.ts
export { Component } from './components/Component';
export type { ComponentProps } from './components/Component';
```

## Key Rules

✅ **Do**:

- Use design tokens (`$small`, `$color9`)
- Implement all interaction states
- Add accessibility props
- Use composition over custom components
- Follow file structure exactly
- Document in Portuguese
- Add mandatory source.transform in Storybook
- Avoid magic numbers when appropriate (use constants/tokens)
- Include `None: undefined` in iconMapping for Storybook reactivity
- Use simple render functions with dynamic keys
- Keep argTypes without conditionals for mapped properties

❌ **Don't**:

- Use hardcoded values
- Skip accessibility
- Create README.md files
- Use direct Text styling
- Forget to export in main index.ts
- Skip source.transform in stories
- Over-engineer simple numeric values
- Add `if` conditions to argTypes with mappings (breaks reactivity)
- Process args in render functions (let Storybook handle mappings)
- Forget dynamic keys in render functions

## Common Storybook Issues

### Problem: "Show code" doesn't update when changing icon/image

**Solution**:

1. Add `None: undefined` to mapping
2. Remove `if: { arg: 'prop', eq: 'value' }` from mapped argTypes
3. Use simple render: `render: args => <Component key={\`comp-${Date.now()}\`} {...args} />`
4. Implement getIconName correctly in source.transform

### Problem: Controls don't appear/work

**Solution**: Check if mapping is defined correctly and without conditionals
